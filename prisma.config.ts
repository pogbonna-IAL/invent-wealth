// This file was generated by Prisma, and assumes you have installed the following:
// npm install --save-dev prisma dotenv
import "dotenv/config";
import { defineConfig } from "prisma/config";

// Ensure DATABASE_URL is available
const databaseUrl = process.env.DATABASE_URL;

if (!databaseUrl) {
  const errorMessage = [
    "DATABASE_URL environment variable is required for Prisma migrations.",
    "",
    "Railway Setup Instructions:",
    "1. In Railway, ensure you have a PostgreSQL service",
    "2. Link the PostgreSQL service to your app service:",
    "   - Go to your app service → Settings → Variables",
    "   - Or use Railway's service linking feature",
    "3. Railway will automatically provide DATABASE_URL when services are linked",
    "",
    "Current Environment:",
    `- NODE_ENV: ${process.env.NODE_ENV || "not set"}`,
    `- Railway: ${process.env.RAILWAY_ENVIRONMENT ? "detected" : "not detected"}`,
    "",
    "If DATABASE_URL is still missing after linking:",
    "- Check Railway service → Variables tab",
    "- Verify PostgreSQL service is running and healthy",
    "- Try redeploying after ensuring services are linked",
  ].join("\n");
  
  throw new Error(errorMessage);
}

export default defineConfig({
  schema: "prisma/schema.prisma",
  migrations: {
    path: "prisma/migrations",
  },
  datasource: {
    url: databaseUrl,
  },
});
