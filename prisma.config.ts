// This file was generated by Prisma, and assumes you have installed the following:
// npm install --save-dev prisma dotenv
// Load dotenv/config for local development (Railway doesn't use .env files)
// dotenv/config only sets variables that don't already exist, so Railway's env vars take precedence
import "dotenv/config";
import { defineConfig } from "prisma/config";

// Get DATABASE_URL from environment at runtime
// Railway injects this when services are linked
// Use a function to read it fresh each time Prisma accesses it
function getDatabaseUrl(): string {
  const url = process.env.DATABASE_URL;
  if (!url) {
    console.warn("Warning: DATABASE_URL not found in environment. Prisma will validate at runtime.");
    console.warn("Available env vars:", Object.keys(process.env).filter(k => k.includes("DATABASE") || k.includes("DB")).join(", ") || "none");
  }
  return url || "";
}

export default defineConfig({
  schema: "prisma/schema.prisma",
  migrations: {
    path: "prisma/migrations",
  },
  datasource: {
    // Read DATABASE_URL at runtime when Prisma needs it
    url: getDatabaseUrl() || process.env.DATABASE_URL || "",
  },
});
